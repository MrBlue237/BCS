<?php require('template/header.phtml'); ?>

    <h2>Create New Placement Post:</h2>

<?php if (!empty($view->postErrors)): ?>
    <div class="alert alert-danger" role="alert">
        <p>Please fix the following errors:</p>
        <ul>
            <?php foreach ($view->postErrors as $error): ?>
                <li><?php echo htmlspecialchars($error); ?></li>
            <?php endforeach; ?>
        </ul>
    </div>
<?php endif; ?>

    <form action="add_post.php" method="POST">

        <div class="form-floating mb-3">
            <input type="text" class="form-control" id="floatingTitle" name="title" required
                   value="<?php echo htmlspecialchars($view->formData['title'] ?? ''); ?>">
            <label for="floatingTitle">Title</label>
        </div>

        <div class="form-floating">
            <input type="number" step="0.01" class="form-control" id="floatingSalary" name="salary" required
                   value="<?php echo htmlspecialchars($view->formData['salary'] ?? ''); ?>">
            <label for="floatingSalary">Salary (e.g., 20000.00)</label>
        </div>

        <div class="form-floating">
            <input type="text" class="form-control" id="floatingLocation" name="location" required
                   value="<?php echo htmlspecialchars($view->formData['location'] ?? ''); ?>">
            <label for="floatingLocation">Location</label>
        </div>

        <div class="form-floating">
            <input type="date" class="form-control" id="floatingStart" name="start" required
                   value="<?php echo htmlspecialchars($view->formData['start'] ?? ''); ?>">
            <label for="floatingStart">Start Date</label>
        </div>

        <div class="form-floating">
            <input type="date" class="form-control" id="floatingEnd" name="end" required
                   value="<?php echo htmlspecialchars($view->formData['end'] ?? ''); ?>">
            <label for="floatingEnd">End date</label>
        </div>

        <div class="form-floating">
            <input type="date" class="form-control" id="floatingDeadline" name="deadline" required
                   value="<?php echo htmlspecialchars($view->formData['deadline'] ?? ''); ?>">
            <label for="floatingDeadline">Application Deadline</label>
        </div>
        <div class="form-floating">
            <textarea class="form-control" id="floatingDescription" name="description" placeholder="Placement description" required><?php echo htmlspecialchars($view->formData['description'] ?? ''); ?></textarea>
            <label for="floatingDescription">Description</label>
        </div>

        <h3 class="mt-4 mb-3">Required SFIA Skills</h3>
        <p class="text-muted">Specify the minimum level (1-7) required for relevant skills. Skills left at 'None' are not required.</p>

        <div class="table-responsive mb-4">
            <table class="table table-striped table-sm">
                <thead>
                <tr>
                    <th>Skill Name</th>
                    <th>Required Level (1-7)</th>
                </tr>
                </thead>
                <tbody>
                <?php
                // $view->availableSkills contains the list of all skills from the DB
                foreach ($view->availableSkills as $skill):
                    $skillCode = htmlspecialchars($skill['skill_code']);
                    $skillName = htmlspecialchars($skill['skill_name']);
                    // Check if the skill was previously submitted to repopulate the form
                    $currentLevel = $view->formData['skills'][$skillCode] ?? 0;
                    ?>
                    <tr>
                        <td><?php echo $skillName; ?> (<?php echo $skillCode; ?>)</td>
                        <td>
                            <select name="skills[<?php echo $skillCode; ?>]" class="form-select form-select-sm">
                                <option value="0">--- None Required ---</option>
                                <?php for ($i = 1; $i <= 7; $i++): ?>
                                    <option value="<?php echo $i; ?>"
                                            <?php echo ($currentLevel == $i) ? 'selected' : ''; ?>>
                                        Level <?php echo $i; ?>
                                    </option>
                                <?php endfor; ?>
                            </select>
                        </td>
                    </tr>
                <?php endforeach; ?>
                </tbody>
            </table>
        </div>

        <button type="submit" class="btn btn-primary" name="add_post">Create Post</button>


    </form>


<?php require('template/footer.phtml'); ?>